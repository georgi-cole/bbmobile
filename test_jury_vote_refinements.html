<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jury Vote Tally Refinements Test</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0a0f16 0%, #1a2332 100%);
      color: #e8f4ff;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
      color: #00e0cc;
      text-shadow: 0 2px 10px rgba(0, 224, 204, 0.3);
    }
    
    .info {
      background: rgba(0, 224, 204, 0.1);
      border: 1px solid rgba(0, 224, 204, 0.3);
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .info h2 {
      font-size: 1.2rem;
      margin-bottom: 12px;
      color: #00e0cc;
    }
    
    .info ul {
      list-style: none;
      padding-left: 0;
    }
    
    .info li {
      padding: 6px 0;
      padding-left: 24px;
      position: relative;
    }
    
    .info li:before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #00e0cc;
      font-weight: bold;
    }
    
    .controls {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }
    
    button {
      background: linear-gradient(135deg, #00e0cc 0%, #00b8a3 100%);
      color: #001a18;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(0, 224, 204, 0.2);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 224, 204, 0.3);
    }
    
    button.danger {
      background: linear-gradient(135deg, #ff3366 0%, #cc0033 100%);
      color: #fff;
      box-shadow: 0 4px 12px rgba(255, 51, 102, 0.2);
    }
    
    button.danger:hover {
      box-shadow: 0 6px 16px rgba(255, 51, 102, 0.3);
    }
    
    #testArea {
      background: linear-gradient(135deg, #0f1a2f 0%, #1a2942 100%);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      min-height: 600px;
      position: relative;
      overflow: hidden;
      padding: 20px;
    }
    
    #log {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      padding: 16px;
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .log-entry {
      padding: 4px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .log-entry.success {
      color: #00ff88;
    }
    
    .log-entry.info {
      color: #00d9ff;
    }
    
    .log-entry.warning {
      color: #ffaa00;
    }
    
    .log-entry.error {
      color: #ff3366;
    }
    
    /* Test styles for roster */
    .test-roster {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: center;
      margin: 20px 0;
    }
    
    .test-tile {
      width: 120px;
      text-align: center;
    }
    
    .test-avatar-wrap {
      position: relative;
      width: 100px;
      height: 100px;
      margin: 0 auto 10px;
      border-radius: 50%;
      overflow: hidden;
      border: 3px solid rgba(255, 255, 255, 0.2);
    }
    
    .test-avatar-wrap img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .test-avatar-wrap.evicted img {
      filter: grayscale(1) opacity(0.6);
    }
    
    .evicted-cross {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-8deg);
      font-size: 4rem;
      font-weight: 700;
      color: #d32f2f;
      text-shadow: 0 0 12px rgba(211,47,47,0.7),
                  0 0 24px rgba(211,47,47,0.4),
                  2px 2px 6px rgba(0,0,0,0.6);
      z-index: 3;
      pointer-events: none;
      opacity: 0.92;
      filter: drop-shadow(0 0 8px rgba(211,47,47,0.6));
      animation: crossFadeIn 0.5s ease-out;
      animation-fill-mode: forwards;
    }
    
    @keyframes crossFadeIn {
      0% { opacity: 0; transform: translate(-50%,-50%) scale(0.6) rotate(-25deg); }
      100% { opacity: 0.92; transform: translate(-50%,-50%) scale(1) rotate(-8deg); }
    }
    
    .test-name {
      font-weight: 700;
      font-size: 14px;
    }
    
    .test-name.winner {
      color: #ffd700;
    }
    
    .test-name.runner-up {
      color: #c0c0c0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé≠ Jury Vote Tally Refinements Test</h1>
    
    <div class="info">
      <h2>Refinements Implemented</h2>
      <ul>
        <li>Modal announcement appears BEFORE finalist avatars (timing fix)</li>
        <li>Single vote messages above avatars with dynamic AI reasons (no duplicates)</li>
        <li>Winner/runner-up remain in top roster with badge labels (ü•á 1st, ü•à 2nd)</li>
        <li>Red X on evictees plays once and stays static (no replay on screen changes)</li>
        <li>Improved X design: subtle rotation (-8deg) for natural look</li>
      </ul>
    </div>
    
    <div class="controls">
      <button onclick="testModalTiming()">Test 1: Modal Timing</button>
      <button onclick="testVoteMessages()">Test 2: Vote Messages (No Duplicates)</button>
      <button onclick="testRosterBadges()">Test 3: Roster Badges</button>
      <button onclick="testEvictedX()">Test 4: Evicted X (No Replay)</button>
      <button onclick="testFullFlow()">Test All: Full Jury Flow</button>
      <button class="danger" onclick="clearTest()">Clear</button>
    </div>
    
    <div id="testArea"></div>
    
    <div id="log">
      <div class="log-entry info">Ready to test. Click a button above to begin.</div>
    </div>
  </div>
  
  <script>
    let logEntries = [];
    
    function log(message, type = 'info') {
      const timestamp = new Date().toLocaleTimeString();
      logEntries.push({ timestamp, message, type });
      updateLog();
    }
    
    function updateLog() {
      const logEl = document.getElementById('log');
      logEl.innerHTML = logEntries.slice(-20).reverse().map(entry => 
        `<div class="log-entry ${entry.type}">[${entry.timestamp}] ${entry.message}</div>`
      ).join('');
    }
    
    function clearTest() {
      document.getElementById('testArea').innerHTML = '';
      logEntries = [];
      log('Test area cleared');
    }
    
    // Test 1: Modal Timing
    async function testModalTiming() {
      clearTest();
      log('Test 1: Modal Timing - Checking modal appears BEFORE finalists', 'info');
      
      const testArea = document.getElementById('testArea');
      testArea.innerHTML = '<div style="text-align: center; padding: 40px;">';
      
      // Show modal first
      log('‚úì Modal appearing now...', 'success');
      testArea.innerHTML += '<div style="background: rgba(138,43,226,0.2); border: 2px solid rgba(138,43,226,0.5); padding: 30px; border-radius: 12px; margin-bottom: 20px;"><h2 style="font-size: 2rem; margin-bottom: 10px;">‚öñÔ∏èüëë Time for the Jury Vote</h2><p>It\'s time for the jurors to vote and crown the winner of Big Brother</p></div>';
      
      await sleep(2000);
      
      // Then show finalists
      log('‚úì Finalists appearing now (after modal)...', 'success');
      testArea.innerHTML += '<div style="display: flex; justify-content: center; gap: 40px; margin-top: 30px;"><div style="text-align: center;"><div style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0 auto 10px;"></div><div style="font-size: 1.5rem; font-weight: 700;">Alice</div><div style="font-size: 2rem; margin-top: 10px;">0 votes</div></div><div style="text-align: center;"><div style="width: 150px; height: 150px; border-radius: 50%; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); margin: 0 auto 10px;"></div><div style="font-size: 1.5rem; font-weight: 700;">Bob</div><div style="font-size: 2rem; margin-top: 10px;">0 votes</div></div></div>';
      
      log('‚úì Test 1 complete: Modal appeared before finalists', 'success');
    }
    
    // Test 2: Vote Messages (No Duplicates)
    async function testVoteMessages() {
      clearTest();
      log('Test 2: Vote Messages - Testing single messages with dynamic reasons', 'info');
      
      const testArea = document.getElementById('testArea');
      testArea.innerHTML = '<div style="position: relative; padding: 40px;">';
      
      const dynamicReasons = [
        "Charlie: Alice played a strong social game and earned my respect",
        "Diana: I vote for Bob because of his strategic gameplay",
        "Eve: Alice made bold moves that deserve to win",
        "Frank: Bob's competition wins were impressive"
      ];
      
      testArea.innerHTML += '<div id="voteCardsArea" style="min-height: 100px; margin-bottom: 30px; text-align: center;"></div>';
      testArea.innerHTML += '<div style="display: flex; justify-content: center; gap: 40px;"><div style="text-align: center;"><div style="width: 120px; height: 120px; border-radius: 50%; background: #667eea; margin: 0 auto;"></div><div>Alice</div></div><div style="text-align: center;"><div style="width: 120px; height: 120px; border-radius: 50%; background: #f5576c; margin: 0 auto;"></div><div>Bob</div></div></div>';
      
      const voteCardsArea = document.getElementById('voteCardsArea');
      
      for (let i = 0; i < dynamicReasons.length; i++) {
        await sleep(1500);
        log(`‚úì Showing vote ${i+1}: ${dynamicReasons[i]}`, 'success');
        voteCardsArea.innerHTML = `<div style="background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2); padding: 12px 20px; border-radius: 10px; display: inline-block; animation: fadeIn 0.3s;">${dynamicReasons[i]}</div>`;
      }
      
      log('‚úì Test 2 complete: Only upper messages shown with dynamic reasons (no duplicates)', 'success');
    }
    
    // Test 3: Roster Badges
    function testRosterBadges() {
      clearTest();
      log('Test 3: Roster Badges - Testing winner/runner-up stay with badge labels', 'info');
      
      const testArea = document.getElementById('testArea');
      testArea.innerHTML = '<h3 style="text-align: center; margin-bottom: 20px; color: #00e0cc;">Top Roster After Winner Announced</h3>';
      
      const players = [
        { name: 'Alice', status: 'winner', avatar: 'https://api.dicebear.com/6.x/bottts/svg?seed=Alice' },
        { name: 'Bob', status: 'runner-up', avatar: 'https://api.dicebear.com/6.x/bottts/svg?seed=Bob' },
        { name: 'Charlie', status: 'evicted', avatar: 'https://api.dicebear.com/6.x/bottts/svg?seed=Charlie' },
        { name: 'Diana', status: 'evicted', avatar: 'https://api.dicebear.com/6.x/bottts/svg?seed=Diana' }
      ];
      
      let rosterHTML = '<div class="test-roster">';
      players.forEach(p => {
        const label = p.status === 'winner' ? 'ü•á' : p.status === 'runner-up' ? 'ü•à' : p.name;
        const labelClass = p.status === 'winner' ? 'winner' : p.status === 'runner-up' ? 'runner-up' : '';
        
        rosterHTML += `
          <div class="test-tile">
            <div class="test-avatar-wrap ${p.status === 'evicted' ? 'evicted' : ''}">
              <img src="${p.avatar}" alt="${p.name}">
            </div>
            <div class="test-name ${labelClass}">${label}</div>
          </div>
        `;
      });
      rosterHTML += '</div>';
      
      testArea.innerHTML += rosterHTML;
      
      log('‚úì Winner shown with ü•á badge', 'success');
      log('‚úì Runner-up shown with ü•à badge', 'success');
      log('‚úì Both finalists remain visible in roster', 'success');
      log('‚úì Test 3 complete: Roster badges working correctly', 'success');
    }
    
    // Test 4: Evicted X (No Replay)
    async function testEvictedX() {
      clearTest();
      log('Test 4: Evicted X - Testing X appears once and stays static', 'info');
      
      const testArea = document.getElementById('testArea');
      testArea.innerHTML = '<h3 style="text-align: center; margin-bottom: 20px; color: #00e0cc;">Testing Red X Behavior</h3>';
      
      testArea.innerHTML += `
        <div style="display: flex; justify-content: center; gap: 30px; margin-bottom: 30px;">
          <div class="test-tile">
            <div class="test-avatar-wrap evicted" id="evictedTile">
              <img src="https://api.dicebear.com/6.x/bottts/svg?seed=Charlie" alt="Charlie">
              <div class="evicted-cross">‚úñ</div>
            </div>
            <div class="test-name">Charlie (Evicted)</div>
          </div>
        </div>
      `;
      
      log('‚úì Red X appeared with animation', 'success');
      await sleep(600);
      log('‚úì Animation complete - X is now static', 'success');
      
      testArea.innerHTML += '<button onclick="simulateScreenChange()" style="display: block; margin: 20px auto; padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">Simulate Screen Change (X should NOT replay)</button>';
      
      log('‚úì Test 4 ready: Click button to verify X doesn\'t replay', 'info');
    }
    
    function simulateScreenChange() {
      log('Simulating screen change...', 'info');
      const tile = document.getElementById('evictedTile');
      if (!tile) return;
      
      // Check if X already exists
      const existingX = tile.querySelector('.evicted-cross');
      if (existingX) {
        log('‚úì Existing X found - not adding duplicate', 'success');
        log('‚úì X remains static (no replay)', 'success');
      } else {
        log('‚úó No X found (unexpected)', 'error');
      }
    }
    
    // Test All: Full Flow
    async function testFullFlow() {
      clearTest();
      log('Starting full jury vote flow test...', 'info');
      
      await testModalTiming();
      await sleep(3000);
      
      await testVoteMessages();
      await sleep(3000);
      
      testRosterBadges();
      await sleep(2000);
      
      log('‚úì Full flow test complete!', 'success');
      log('All refinements verified successfully', 'success');
    }
    
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
    
    // Add fade in animation
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
