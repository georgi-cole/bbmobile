<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Progression UI Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1000px;
      margin: 40px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #e0e0e0;
    }
    h1 {
      color: #ffdc8b;
      border-bottom: 2px solid #ffdc8b;
      padding-bottom: 10px;
    }
    .demo-section {
      margin: 30px 0;
      padding: 20px;
      background: #2a2a2a;
      border-radius: 8px;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      background: linear-gradient(135deg, #ffdc8b 0%, #ffa500 100%);
      border: none;
      border-radius: 6px;
      color: #1a1a1a;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
    }
    #badge-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
  </style>
</head>
<body>
  <h1>Progression UI Components Test</h1>
  <p>Testing XP badge and modal components</p>

  <div class="demo-section">
    <h2>XP Badge Component</h2>
    <div id="badge-container"></div>
    <button onclick="createTestBadge()">Create Badge</button>
    <button onclick="updateBadges()">Update Badges</button>
  </div>

  <div class="demo-section">
    <h2>XP Modal Component</h2>
    <button onclick="showTestModal()">Show Modal</button>
    <button onclick="showModalWithData()">Show Modal with Data</button>
  </div>

  <!-- Mock game object -->
  <script>
    window.g = window.g || {};
    window.g.cfg = window.g.cfg || { progressionEnabled: true };
    localStorage.setItem('progression.enabled', 'true');
  </script>

  <!-- Load progression modules -->
  <script type="module">
    import * as xpBadge from './src/progression/xp-badge.js';
    import * as xpModal from './src/progression/xp-modal.js';
    import * as core from './src/progression/dist/core.js';

    window.xpBadge = xpBadge;
    window.xpModal = xpModal;
    window.progressionCore = core;

    let badges = [];

    window.createTestBadge = function() {
      const container = document.getElementById('badge-container');
      const badge = xpBadge.createBadge(container, {
        theme: 'dark',
        onClick: () => {
          alert('Badge clicked!');
        }
      });
      
      // Initialize with test data
      badge.update({
        level: 1,
        totalXP: 0
      });
      
      badges.push(badge);
    };

    window.updateBadges = async function() {
      try {
        await core.initialize();
        const state = await core.getCurrentState();
        badges.forEach(badge => badge.update(state));
        console.log('Updated badges with state:', state);
      } catch (error) {
        console.error('Failed to update badges:', error);
      }
    };

    window.showTestModal = function() {
      const modal = xpModal.createModal({
        theme: 'dark',
        onClose: () => {
          console.log('Modal closed');
        }
      });
      
      // Show with test data
      const testState = {
        totalXP: 375,
        level: 3,
        nextLevelXP: 500,
        currentLevelXP: 250,
        progressPercent: 50,
        eventsCount: 5
      };
      
      const testBreakdown = new Map([
        ['HOH_WIN', { count: 2, totalXP: 300, ruleName: 'Head of Household' }],
        ['POV_WIN', { count: 1, totalXP: 125, ruleName: 'Power of Veto' }],
        ['NOMINATED', { count: 1, totalXP: -50, ruleName: 'Nominated' }]
      ]);
      
      modal.updateOverview(testState, core.DEFAULT_LEVEL_THRESHOLDS);
      modal.updateBreakdown(testBreakdown);
      modal.updateUnlocks(testState, core.DEFAULT_LEVEL_THRESHOLDS);
    };

    window.showModalWithData = async function() {
      try {
        await core.initialize();
        
        // Add some test events
        await core.recordEvent('HOH_WIN', 150, { week: 1, season: 1 });
        await core.recordEvent('POV_WIN', 125, { week: 1, season: 1 });
        await core.recordEvent('COMP_WIN', 100, { week: 2, season: 1 });
        
        const state = await core.getCurrentState();
        const breakdown = await core.getBreakdown();
        
        const modal = xpModal.createModal({
          theme: 'dark',
          onClose: () => {
            console.log('Modal closed');
          }
        });
        
        modal.updateOverview(state, core.DEFAULT_LEVEL_THRESHOLDS);
        modal.updateBreakdown(breakdown);
        modal.updateUnlocks(state, core.DEFAULT_LEVEL_THRESHOLDS);
        
        console.log('Modal shown with real data:', { state, breakdown });
      } catch (error) {
        console.error('Failed to show modal:', error);
      }
    };

    // Auto-create one badge on load
    window.addEventListener('DOMContentLoaded', () => {
      createTestBadge();
    });
  </script>
</body>
</html>
