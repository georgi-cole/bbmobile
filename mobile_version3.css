:root {
  --safe-top: env(safe-area-inset-top);
  --safe-bottom: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
}
html, body { height: 100%; background: #0f1320; }
body {
  padding: calc(var(--safe-top,0) + 6px) calc(var(--safe-right,0) + 6px) calc(var(--safe-bottom,0) + 6px) calc(var(--safe-left,0) + 6px);
  -webkit-touch-callout: none; -webkit-user-select: none; user-select: none; touch-action: manipulation;
}
.topbar { flex-wrap: wrap; gap: 6px; }
.topbar .btn { min-height: 36px; min-width: 44px; }
.wrap { display: flex; flex-direction: column; gap: 10px; }
.card { border-radius: 12px; }
#tv { aspect-ratio: 16/9; width: 100%; max-height: 56vh; position: relative; }
#panel { max-height: 42vh; overflow: auto; -webkit-overflow-scrolling: touch; }
#sideCard .tabBar { position: sticky; top: 0; }
@media (min-width: 900px) {
  .wrap { flex-direction: row; align-items: flex-start; }
  #actionCard { flex: 1 1 60%; }
  #dashboardCard, #sideCard { flex: 1 1 40%; }
}
button.btn, .tab-btn { min-height: 40px; padding: 8px 12px; }
@media (max-width: 480px) { #debugPanel { display: none !important; } }

/* Mobile responsive improvements for Settings/Cast and modals */
@media (max-width: 540px) {
  /* Constrain modals and panels to viewport width */
  .modal, .overlay-panel, .bigCard, .card-overlay {
    max-width: 100vw !important;
    width: calc(100vw - 20px) !important;
    margin: 0 10px !important;
    padding: 12px !important;
  }

  /* Settings modal - full-screen sheet with inner scroll */
  #settingsBackdrop {
    align-items: flex-start !important;
    padding: 0 !important;
  }

  #settingsBackdrop .modal {
    position: fixed !important;
    inset: 0 !important;
    width: 100vw !important;
    max-width: 100vw !important;
    height: 100svh !important;
    max-height: 100svh !important;
    margin: 0 !important;
    padding: 10px !important;
    border-radius: 0 !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Modal body becomes scrollable container */
  #settingsBackdrop .modal #settingsPanes {
    flex: 1 !important;
    min-height: 0 !important;
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch;
    padding-bottom: calc(var(--safe-bottom, 0px) + 80px) !important;
  }

  /* Keep header and tabs sticky */
  #settingsBackdrop .modal h2,
  #settingsBackdrop .modal #settingsTabs {
    flex-shrink: 0 !important;
  }

  /* Action buttons at bottom */
  #settingsBackdrop .modal .row.between {
    flex-shrink: 0 !important;
    padding-bottom: calc(var(--safe-bottom, 0px) + 4px) !important;
  }

  /* Settings modal: scope button/input/pill compaction ONLY to settings modal */
  #settingsBackdrop button.btn,
  #settingsBackdrop .tab-btn {
    padding: 6px 10px !important;
    font-size: 0.85rem !important;
    min-height: 36px !important;
  }

  #settingsBackdrop .pill {
    padding: 4px 7px !important;
    font-size: 0.65rem !important;
  }

  #settingsBackdrop input,
  #settingsBackdrop select,
  #settingsBackdrop textarea {
    font-size: 0.9rem !important;
    padding: 6px 8px !important;
  }

  /* Settings grid - reduce padding for cards */
  .settingsGrid .card {
    padding: 8px !important;
  }

  .settingsGrid h3 {
    font-size: 0.85rem !important;
    margin-bottom: 4px !important;
  }

  /* Cast pane specific - compact everything */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-editor {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-preview {
    align-items: center !important;
    margin-bottom: 8px !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-preview img {
    width: 100px !important;
    height: 100px !important;
  }

  /* Cast form - ensure inputs fit and stack properly */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-form {
    grid-template-columns: 1fr !important;
    gap: 6px !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-form label {
    font-size: 0.75rem !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-form input,
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-form select {
    width: 100% !important;
    box-sizing: border-box !important;
    font-size: 14px !important;
    padding: 6px 8px !important;
    min-width: 0 !important;
  }

  /* Cast strip - horizontal scroll for roster with proper container */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-strip {
    overflow-x: auto !important;
    overflow-y: hidden !important;
    padding: 8px !important;
    -webkit-overflow-scrolling: touch;
    border-radius: 10px !important;
    width: 100% !important;
    box-sizing: border-box !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-chip {
    min-width: 56px !important;
    flex-shrink: 0 !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .chip-ava {
    width: 48px !important;
    height: 48px !important;
  }

  /* Cast preview image - smaller on mobile */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-avatar-upload {
    width: 100px !important;
    height: 100px !important;
    margin: 0 auto !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-avatar-upload img {
    width: 100% !important;
    height: 100% !important;
  }

  /* Cast actions - stack and full width on mobile */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-actions {
    display: flex !important;
    flex-direction: column !important;
    gap: 8px !important;
    margin-top: 12px !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-actions .btn {
    width: 100% !important;
    min-width: 0 !important;
  }

  /* Ensure card doesn't overflow on mobile */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .card {
    padding: 10px 8px !important;
    max-width: 100% !important;
    overflow: visible !important;
    margin-bottom: 12px !important;
  }

  #settingsBackdrop .settingsTabPane[data-pane="cast"] .cast-wrap {
    max-width: 100% !important;
    overflow: visible !important;
  }

  /* Cast Editor title spacing */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] h3 {
    font-size: 0.9rem !important;
    margin-bottom: 6px !important;
  }

  /* Progress indicator spacing */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] #castProgress {
    font-size: 0.7rem !important;
  }

  /* Reduce vertical spacing in Cast Editor */
  #settingsBackdrop .settingsTabPane[data-pane="cast"] .sep {
    margin: 4px 0 !important;
  }

  /* Settings and Cast table improvements */
  .cast-table, .settings-table {
    font-size: 0.85rem;
  }

  .cast-table td, .settings-table td,
  .cast-table th, .settings-table th {
    padding: 6px 4px !important;
    font-size: 0.8rem;
  }

  .cast-table img, .avatar-img {
    width: 36px !important;
    height: 36px !important;
    min-width: 36px !important;
  }

  /* Cast grid fallback for 2-column layout */
  .castGrid, .cast-grid {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 8px !important;
  }

  .castGrid > div, .cast-grid > div {
    padding: 8px !important;
  }

  /* Smaller paddings for tiles and cards */
  .tile, .player-tile, .cast-tile {
    padding: 8px !important;
    margin: 4px !important;
  }

  /* Settings modal specific */
  .settings-modal .row, .settings-row {
    gap: 8px !important;
  }

  .settings-modal label {
    font-size: 0.85rem !important;
  }
}
